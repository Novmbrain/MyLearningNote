# 自顶向下

## 常见英文单词

```
Process 进程
message 报文
socket套接字
Application Programming Interface 应用程序编程接口
IP address IP地址
port number 端口号
reliable data transfer 可靠数据传输
application-layer protocol 应用层协议
Round-Trip Time， RTT 往返时间
```



## 第二章 应用层

网络应用是计算机网络存在的理由

### 2.1 应用层协议原理

#### 进程和线程的区别

**进程和线程都是一个时间段的描述，是CPU工作时间段的描述。是运行中的程序指令的一种描述，这需要与程序中的代码区别开来**

在CPU看来所有的任务都是一个一个的轮流执行的，具体的轮流方法就是：***先加载进程A的上下文，然后开始执行A，保存进程A的上下文，调入下一个要执行的进程B的进程上下文，然后开始执行B,保存进程B的上下文。。。***

什么是线程？

进程的颗粒度太大，每次的执行都要进行进程上下文的切换。如果我们把进程比喻为一个运行在电脑上的软件，那么一个软件的执行不可能是一条逻辑执行的，必定有多个分支和多个程序段，就好比要实现程序A，实际分成 a，b，c等多个块组合而成。那么这里具体的执行就可能变成。

程序A得到CPU =》CPU加载上下文，开始执行程序A的a小段，然后执行A的b小段，然后再执行A的c小段，最后CPU保存A的上下文。

这里a，b，c的执行是共享了A进程的上下文，CPU在执行的时候仅仅切换线程的上下文，而没有进行进程上下文切换的。进程的上下文切换的时间开销是远远大于线程上下文时间的开销。这样就让CPU的有效使用率得到提高。这**里的a，b，c就是线程，也就是说线程是共享了进程的上下文环境，的更为细小的CPU时间段。线程主要共享的是进程的地址空间。**

总结：**进程和线程都是一个时间段的描述，是CPU工作时间段的描述，不过是颗粒大小不同。**

---------

#### 进程寻址

为了标识一个接受进程，需要定义两个信息

- 主机的地址：IP地址
- 定义在目的主机中的接受进程的标识符：端口号

--------

#### 进程与计算机网络之间的接口

进程通过套接字socket的API向网络发送报文和从网络中接收报文。套接字是应用程序和网络之间的API

---------------

#### TCP服务和UDP服务

当某个应用程序调用TCP作为其运输协议时，该应用程序就能获得来自TCP的两种服务

- 面向连接的服务：在发送报文之前，TCP首先会让客户和服务器交换运输层的控制信息，也就是所谓的握手。在捂手后，一个TCP连接就在两个套接字之间建立
- 可靠的数据传输

同时TCP协议还具有拥塞控制机制

UDP是一种不提供不必要服务的轻量级运输协议。无连接没有握手过程，不可靠传输，没有拥塞控制机制





### 2.2 Web和HTTP

Web的应用层协议为HTTP协议，HTTP协议使用TCP协议作为支撑的运输协议（为了保证可靠传输）

HTTP协议是一个无状态协议(stateless protocol)，HTTP服务器不会保存关于客户的任何信息

#### 非持续连接和持续连接

当客户-服务器的交互经TCP进行时，应用程序的研制者需要确定，每个请求/响应对是经单独的TCP连接发送（非持续连接），还是所有的请求响应经过相同的TCP连接发送（持续连接）

"三次握手"：即是客户向服务器发送一个小TCP报文段，服器务用一个小TCP报文段做出确认和响应，最后，客户向服务器返回确认

##### 非持续连接



![image-20210222205249455](D:\编程学习\MD笔记\自顶向下\请求并接收一个HTML文件所需的时间估算.png)

若将三次握手的第三部分（客户端先服务器发送一个小TCP报文段）和向TCP连接发送一个HTTP请求报文放一起。非持续连接的总响应时间约为两个RRT加上服务器传输HTML文件的时间。

HTTP的默认模式是使用带流水线的持续连接（流水线：可以一个接着一个地发出对对象的这些请求，而不必等待对未决请求的回答）

